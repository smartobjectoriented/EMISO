<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. User Guide &mdash; Smart Object Oriented 2021.2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=b4aaf8b5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. Logging facility" href="logging.html" />
    <link rel="prev" title="7. EMISO Engine" href="emiso_engine/emiso_engine.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Smart Object Oriented
          </a>
              <div class="version">
                2021.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture/architecture.html">2. SOO Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="drivers/drivers.html">3. Frontend &amp; backend drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="rootfs/rootfs.html">4. User applications and rootfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/docker.html">5. Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="portainer/portainer.html">6. Portainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="emiso_engine/emiso_engine.html">7. EMISO Engine</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pre-requisite">8.1. Pre-requisite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#toolchain">8.1.1. Toolchain</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basic-components">8.2. Basic Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#qemu">8.2.1. QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trustzone-related-components">8.2.2. TrustZone Related Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#arm-trusted-firmware-trusted-firmware-a-also-known-as-atf">8.2.2.1. ARM Trusted firmware (trusted-firmware-a) also known as ATF</a></li>
<li class="toctree-l4"><a class="reference internal" href="#otee-os-open-trusted-execution-environment">8.2.2.2. OTEE_OS (Open Trusted Execution Environment)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optee-ta-trusted-applications">8.2.2.3. OPTEE TA (Trusted Applications)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#u-boot">8.3. U-boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#soo-components">8.4. SOO Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agency">8.4.1. Agency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#target-platforms">8.4.1.1. Target platforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#main-root-filesystem-rootfs">8.4.1.2. Main root filesystem (<strong>rootfs</strong>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initial-ramfs-initrd-filesystem">8.4.1.3. Initial ramfs (initrd) filesystem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agency-user-applications">8.4.1.4. Agency user applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agency-filesystem">8.4.1.5. Agency filesystem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deployment-into-the-storage-device">8.4.1.6. Deployment into the storage device</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mobile-entity-me">8.4.2. Mobile Entity (ME)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#me-build">8.4.2.1. ME Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#me-build-script">8.4.2.2. ME build script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#final-deployment">8.4.2.3. Final Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#me-injection-from-the-agency">8.4.2.4. ME Injection from the Agency</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">9. Logging facility</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html#enabling-initcall-logging">10. Enabling <code class="docutils literal notranslate"><span class="pre">initcall</span></code> logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="board_issues.html">11. Board related issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="aarch64.html">12. Configuration for AArch64 64-bit architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_flow.html">13. Development  flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">14. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="specifications/specifications.html">15. Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos/demos.html">16. Demos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Smart Object Oriented</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">8. </span>User Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide">
<span id="id1"></span><h1><span class="section-number">8. </span>User Guide<a class="headerlink" href="#user-guide" title="Link to this heading">¶</a></h1>
<p>The installation should work in any Ubuntu/Kubuntu installation superior
to <code class="docutils literal notranslate"><span class="pre">16.10</span></code>. It is assumed that you are running an x86_64 version.</p>
<p>The following setup prepares to run the SOO framework in a QEMU-based
emulated environment. There is a file called <strong>build.conf</strong> in the
<em>agency/</em> directory which specifies the target platform. After a fresh
clone, build.conf is configured for QEMU <em>vExpress</em> platform.</p>
<p>Additionally, the <em>vExpress</em> target is also configured with TrustZone
support.</p>
<section id="pre-requisite">
<h2><span class="section-number">8.1. </span>Pre-requisite<a class="headerlink" href="#pre-requisite" title="Link to this heading">¶</a></h2>
<p>We need to run some i386 executables, and we need to install some i386
libraries too.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>dpkg<span class="w"> </span>--add-architecture<span class="w"> </span>i386
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libc6:i386<span class="w"> </span>libncurses5:i386<span class="w"> </span>libstdc++6:i386
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>lib32z1-dev
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>zlib1g:i386
</pre></div>
</div>
<p>Various other packages are required:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>pkg-config<span class="w"> </span>libgtk2.0-dev<span class="w"> </span>bridge-utils
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>unzip<span class="w"> </span>bc
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>elfutils<span class="w"> </span>u-boot-tools
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>device-tree-compiler
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>fdisk
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libncurses-dev
</pre></div>
</div>
<p>The OP-TEE environment requires the following python packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3<span class="w"> </span>install<span class="w"> </span>pycryptodome
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python3-pyelftools
</pre></div>
</div>
<p>The following packets are not mandatory, but they can be installed to
prevent annoying warnings:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>bison<span class="w"> </span>flex
</pre></div>
</div>
<section id="toolchain">
<h3><span class="section-number">8.1.1. </span>Toolchain<a class="headerlink" href="#toolchain" title="Link to this heading">¶</a></h3>
<p>The AArch-32 (ARM 32-bit) toolchain can be installed with the following commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/toolchains<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/opt/toolchains
<span class="c1"># Download and extract arm-none-linux-gnueabihf toolchain (gcc v11.3.1).</span>
$<span class="w"> </span>sudo<span class="w"> </span>wget<span class="w"> </span>https://snapshots.linaro.org/gnu-toolchain/11.3-2022.06-1/arm-linux-gnueabihf/gcc-linaro-11.3.1-2022.06-x86_64_arm-linux-gnueabihf.tar.xz
$<span class="w"> </span>sudo<span class="w"> </span>tar<span class="w"> </span>xf<span class="w"> </span>gcc-linaro-11.3.1-2022.06-x86_64_arm-linux-gnueabihf.tar.xz
$<span class="w"> </span>sudo<span class="w"> </span>rm<span class="w"> </span>gcc-linaro-11.3.1-2022.06-x86_64_arm-linux-gnueabihf.tar.xz
$<span class="w"> </span>sudo<span class="w"> </span>mv<span class="w"> </span>gcc-linaro-11.3.1-2022.06-x86_64_arm-linux-gnueabihf<span class="w"> </span>arm-linux-gnueabihf_11.3.1
$<span class="w"> </span>sudo<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;${PATH}:/opt/toolchains/arm-linux-gnueabihf_11.3.1/bin&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/profile.d/02-toolchains.sh
</pre></div>
</div>
<p>For the 64-bit version (virt &amp; RPi4), the AArch-64 (ARM 64-bit) toolchain can be installed with the following commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/toolchains<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/opt/toolchains
<span class="c1"># Download and extract arm-none-linux-gnueabihf toolchain (gcc v10.2).</span>
$<span class="w"> </span>sudo<span class="w"> </span>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
$<span class="w"> </span>sudo<span class="w"> </span>tar<span class="w"> </span>xf<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
$<span class="w"> </span>sudo<span class="w"> </span>rm<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
$<span class="w"> </span>sudo<span class="w"> </span>mv<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu<span class="w"> </span>aarch64-none-linux-gnu_10.2
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;${PATH}:/opt/toolchains/aarch64-none-linux-gnu_10.2/bin&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/profile.d/02-toolchains.sh
</pre></div>
</div>
</section>
</section>
<section id="basic-components">
<h2><span class="section-number">8.2. </span>Basic Components<a class="headerlink" href="#basic-components" title="Link to this heading">¶</a></h2>
<p>Currently, the framework contains all what is required to get a full
functional environment. It includes the QEMU emulator, ARM TrustZone
components, U-boot bootlader, etc.</p>
<section id="qemu">
<h3><span class="section-number">8.2.1. </span>QEMU<a class="headerlink" href="#qemu" title="Link to this heading">¶</a></h3>
<p>Currently QEMU is version <em>5.2</em> QEMU requires the additional package to
be installed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3<span class="w"> </span>install<span class="w"> </span>ninja
</pre></div>
</div>
<p>From the root of the repository: (the configuration for qemu is
available in README.soo)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>qemu
./configure<span class="w"> </span>--target-list<span class="o">=</span>arm-softmmu<span class="w"> </span>--disable-attr<span class="w"> </span>--disable-docs
make<span class="w"> </span>-j8
</pre></div>
</div>
<p>It may take some time, be patient!</p>
</section>
<section id="trustzone-related-components">
<h3><span class="section-number">8.2.2. </span>TrustZone Related Components<a class="headerlink" href="#trustzone-related-components" title="Link to this heading">¶</a></h3>
<p>Since the SOO agency relies on TrustZone for security concerns, it is
necessary to compile the trusted-firmware-a package as follows:</p>
<section id="arm-trusted-firmware-trusted-firmware-a-also-known-as-atf">
<h4><span class="section-number">8.2.2.1. </span>ARM Trusted firmware (trusted-firmware-a) also known as ATF<a class="headerlink" href="#arm-trusted-firmware-trusted-firmware-a-also-known-as-atf" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>trusted-firmware-a
./build.sh
</pre></div>
</div>
</section>
<section id="otee-os-open-trusted-execution-environment">
<h4><span class="section-number">8.2.2.2. </span>OTEE_OS (Open Trusted Execution Environment)<a class="headerlink" href="#otee-os-open-trusted-execution-environment" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>optee_os
./build.sh
</pre></div>
</div>
</section>
<section id="optee-ta-trusted-applications">
<h4><span class="section-number">8.2.2.3. </span>OPTEE TA (Trusted Applications)<a class="headerlink" href="#optee-ta-trusted-applications" title="Link to this heading">¶</a></h4>
<p>The <em>optee_ta/</em> directory contains our trusted applications used to
cipher/uncipher the ME, discovery beacons, etc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>optee_ta
./build.sh
</pre></div>
</div>
</section>
</section>
</section>
<section id="u-boot">
<h2><span class="section-number">8.3. </span>U-boot<a class="headerlink" href="#u-boot" title="Link to this heading">¶</a></h2>
<p>The bootloader used by SOO is <strong>U-boot</strong>. In the sub-directory, there
are also various environment files used by the bootloader.</p>
<p>From 2019, the build system of agency and MEs is strongly based upon
U-boot ITB binary files which contain all necessary components. Not only
the SOO Agency is entirely contained in an ITB file, but also the Mobile
Entities (MEs) which are produced as that.</p>
<p>The compilation of <em>U-boot</em> is done with the following config and
commands (from the soo directory):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>u-boot
make<span class="w"> </span>vexpress_defconfig
make<span class="w"> </span>-j8
</pre></div>
</div>
<p>The following configurations are available:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Platform</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>vexpress_defconfig</em></p></td>
<td><p>Basic QEMU/vExpress 32-bit platform</p></td>
</tr>
<tr class="row-odd"><td><p><em>virt64_defconfig</em></p></td>
<td><p>QEMU/virt 64-bit platform</p></td>
</tr>
<tr class="row-even"><td><p><em>rpi_4_32b_defconfig</em></p></td>
<td><p>Raspberry Pi 4 in 32-bit mode</p></td>
</tr>
<tr class="row-odd"><td><p><em>rpi4_64_defconfig</em></p></td>
<td><p>Raspberry Pi 4 in 64-bit mode</p></td>
</tr>
</tbody>
</table>
<p>(The last one is a custom configuration and is to be used as replacemenent
of rpi_4_defconfig)</p>
</section>
<section id="soo-components">
<h2><span class="section-number">8.4. </span>SOO Components<a class="headerlink" href="#soo-components" title="Link to this heading">¶</a></h2>
<section id="agency">
<h3><span class="section-number">8.4.1. </span>Agency<a class="headerlink" href="#agency" title="Link to this heading">¶</a></h3>
<p>This section presents the different components which are required to be
built in the <strong>agency/</strong> directory. Different configurations are possible.</p>
<section id="target-platforms">
<h4><span class="section-number">8.4.1.1. </span>Target platforms<a class="headerlink" href="#target-platforms" title="Link to this heading">¶</a></h4>
<p>The file <code class="docutils literal notranslate"><span class="pre">build.conf</span></code> in <code class="docutils literal notranslate"><span class="pre">agency/</span></code> contains the <code class="docutils literal notranslate"><span class="pre">PLATFORM</span></code> (and eventually <code class="docutils literal notranslate"><span class="pre">TYPE</span></code>) variables
to select the target platform.</p>
<p>Possible platforms and types are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Platform</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>vexpress</em></p></td>
<td><p>Basic QEMU/vExpress 32-bit platform</p></td>
</tr>
<tr class="row-odd"><td><p><em>virt64</em></p></td>
<td><p>QEMU/virt 64-bit platform</p></td>
</tr>
<tr class="row-even"><td><p><em>rpi4</em></p></td>
<td><p>Raspberry Pi 4 in 32-bit mode</p></td>
</tr>
<tr class="row-odd"><td><p><em>rpi4_64</em></p></td>
<td><p>Raspberry Pi 4 in 64-bit mode</p></td>
</tr>
</tbody>
</table>
<p>If <em>vexpress</em> is selected, it is (still) necessary to add a TYPE. Only, <code class="docutils literal notranslate"><span class="pre">tz</span></code> type
is supported.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TYPE</span></code> variable is useless and will be removed soon.</p>
</div>
</section>
<section id="main-root-filesystem-rootfs">
<h4><span class="section-number">8.4.1.2. </span>Main root filesystem (<strong>rootfs</strong>)<a class="headerlink" href="#main-root-filesystem-rootfs" title="Link to this heading">¶</a></h4>
<p>In the code below, you have to replace <code class="docutils literal notranslate"><span class="pre">MYARCH</span></code> with the selected architecture.
All available configurations (*_defconfig) are placed in
the <code class="docutils literal notranslate"><span class="pre">configs/</span></code> directory.</p>
<ul class="simple">
<li><p>If the chosen architecture is <code class="docutils literal notranslate"><span class="pre">vexpress</span></code>, <em>MYARCH</em> should be <em>vexpress</em>.</p></li>
<li><p>If the chosen architecture is <code class="docutils literal notranslate"><span class="pre">Raspberry</span> <span class="pre">Pi</span> <span class="pre">4</span></code>: <em>MYARCH</em> should be <em>rpi4</em> .</p></li>
<li><p>etc.</p></li>
</ul>
<p>The following commands first retrieve all packages in a first step, then it compiles everything.
It may take quite a long time… Be patient!</p>
<p>From the agency’s directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>rootfs
make<span class="w"> </span>MYARCH_defconfig
make<span class="w"> </span><span class="nb">source</span>
make
</pre></div>
</div>
<p>The build of the agency including <strong>AVZ</strong> and <strong>Linux</strong> is
done by doing simply a make in the <code class="docutils literal notranslate"><span class="pre">agency/</span></code> root directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>agency
make
</pre></div>
</div>
</section>
<section id="initial-ramfs-initrd-filesystem">
<h4><span class="section-number">8.4.1.3. </span>Initial ramfs (initrd) filesystem<a class="headerlink" href="#initial-ramfs-initrd-filesystem" title="Link to this heading">¶</a></h4>
<p>In the agency, there is an <code class="docutils literal notranslate"><span class="pre">initrd</span></code> filesystem which is embedded in
the <em>ITB</em> image file. In order to access the content of this <em>initrd</em>,
a script in <code class="docutils literal notranslate"><span class="pre">agency/rootfs</span></code> is available. For example, to access
the content of the <em>vexpress</em> board:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>rootfs
./mount_initrd.sh<span class="w"> </span>vexpress
<span class="nb">cd</span><span class="w"> </span>fs
</pre></div>
</div>
<p>Unmounting the filesystem is done with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>rootfs
./umount_initrd.sh<span class="w"> </span>vexpress
</pre></div>
</div>
</section>
<section id="agency-user-applications">
<h4><span class="section-number">8.4.1.4. </span>Agency user applications<a class="headerlink" href="#agency-user-applications" title="Link to this heading">¶</a></h4>
<p>In addition to the <code class="docutils literal notranslate"><span class="pre">rootfs</span></code>, the Agency has its own applications that
can be found in <code class="docutils literal notranslate"><span class="pre">agency/usr</span></code>. The build system of this part relies on
CMake. The build is achieved with the following script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">agency</span><span class="o">/</span><span class="n">usr</span>
<span class="o">./</span><span class="n">build</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
<section id="agency-filesystem">
<h4><span class="section-number">8.4.1.5. </span>Agency filesystem<a class="headerlink" href="#agency-filesystem" title="Link to this heading">¶</a></h4>
<p>Once all main Agency components have been built, they will be put in a
virtual disk image as it is possible to attach such a virtual SD-Card
storage device with QEMU). The virtual storage is created in
<code class="docutils literal notranslate"><span class="pre">filesystem/</span></code> directory and will contain all the necessary partitions.</p>
<p>The creation of the virtual disk image is done as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>agency/filesystem
./create_img.sh<span class="w"> </span>vexpress
</pre></div>
</div>
</section>
<section id="deployment-into-the-storage-device">
<h4><span class="section-number">8.4.1.6. </span>Deployment into the storage device<a class="headerlink" href="#deployment-into-the-storage-device" title="Link to this heading">¶</a></h4>
<p>Finally, the deployment of all Agency components (including the
bootloader in some configurations) is achieved with the following script
(option <code class="docutils literal notranslate"><span class="pre">-a</span></code> for all)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>agency
./deploy.sh<span class="w"> </span>-a
</pre></div>
</div>
<p>The script has different options (try simply <code class="docutils literal notranslate"><span class="pre">./deploy.sh</span></code> to get all
options).</p>
<p>Yeahhh!… Now it is time to make a try by launching the SOO Agency with
the following script, in the <code class="docutils literal notranslate"><span class="pre">root/</span></code> directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./st
</pre></div>
</div>
<p>The script will launch QEMU with the correct options and the Agency
should start with the AVZ hypervisor and the Linux environment. You
should get a prompt entitled:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="sb">`</span>agency<span class="w"> </span>~<span class="w"> </span><span class="c1">#`</span>
</pre></div>
</div>
</section>
</section>
<section id="mobile-entity-me">
<h3><span class="section-number">8.4.2. </span>Mobile Entity (ME)<a class="headerlink" href="#mobile-entity-me" title="Link to this heading">¶</a></h3>
<p>For a quick test, it is proposed to build and to deploy the SOO.refso3
reference Mobile Entity.</p>
<section id="me-build">
<h4><span class="section-number">8.4.2.1. </span>ME Build<a class="headerlink" href="#me-build" title="Link to this heading">¶</a></h4>
<p>The main <code class="docutils literal notranslate"><span class="pre">ME</span></code>directory is amazingly <code class="docutils literal notranslate"><span class="pre">ME</span></code> at the root. The
<code class="docutils literal notranslate"><span class="pre">ME/base</span></code> directory contains all the source code and related files of
all mobile entities. Indeed, each ME is produced according to their
configuration file and device tree.</p>
<p>Basically, a ME is constituted of its kernel (based on SO3 Operating
System), a device tree and eventually a rootfs used as <strong>ramfs</strong> (the
rootfs is embedded in the ME image itself, hence the ITB file).</p>
</section>
<section id="me-build-script">
<h4><span class="section-number">8.4.2.2. </span>ME build script<a class="headerlink" href="#me-build-script" title="Link to this heading">¶</a></h4>
<p>The ME can be build using the build.sh script found in <code class="docutils literal notranslate"><span class="pre">ME/base</span></code> directory.
This script takes 3 arguments 2 of which a mandatory and an optional one.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./build.sh

Build<span class="w"> </span>ME
Usage:<span class="w"> </span>./build.sh<span class="w"> </span>-OPTIONS<span class="w"> </span>&lt;ME_NAME&gt;<span class="w"> </span><span class="o">[</span>OPTIONAL_CONFIG<span class="o">]</span>
OPTIONS:
-k<span class="w">    </span>build<span class="w"> </span>kernel<span class="w"> </span>only
-u<span class="w">    </span>build<span class="w"> </span>user<span class="w"> </span>apps<span class="w"> </span>only
-ku<span class="w">   </span>build<span class="w"> </span>kernel<span class="w"> </span>and<span class="w"> </span>apps

Clean<span class="w"> </span>ME
Usage:<span class="w"> </span>./build.sh<span class="w"> </span>-c<span class="w"> </span>&lt;ME_NAME&gt;<span class="w"> </span>&lt;OTPIONAL_CONFIG&gt;

ME_NAME<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>one<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>following:
-<span class="w"> </span>SOO.agency
-<span class="w"> </span>SOO.blind
-<span class="w"> </span>SOO.ledctrl
-<span class="w"> </span>SOO.net
-<span class="w"> </span>SOO.outdoor
-<span class="w"> </span>SOO.refso3
-<span class="w"> </span>SOO.wagoled

OPTIONAL_CONFIG<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>one<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>following:
-<span class="w"> </span>refso3_ramfs

Examples:
./build.sh<span class="w"> </span>-k<span class="w"> </span>SOO.refso3
./build.sh<span class="w"> </span>-ku<span class="w"> </span>SOO.refso3<span class="w"> </span>refso3_ramfs
</pre></div>
</div>
<ul class="simple">
<li><p>The OPTIONS argument allow you to build just the kernel <code class="docutils literal notranslate"><span class="pre">-k</span></code>, just the user space <code class="docutils literal notranslate"><span class="pre">-u</span></code> or both <code class="docutils literal notranslate"><span class="pre">-ku</span></code>. The <code class="docutils literal notranslate"><span class="pre">-c</span></code> option clean up the build.</p></li>
<li><p>The ME_NAME argument allow you to select which ME you want too build. You must use the SOO.&lt;ME_NAME&gt; syntax.</p></li>
<li><p>The OPTIONAL_CONFIG allow you to select a specific config for an ME if more than one exist. See <cite>Examples</cite> above.</p></li>
</ul>
<p>The build output <cite>&lt;ME_NAME&gt;.itb</cite> will be put inside the <code class="docutils literal notranslate"><span class="pre">ME/SOO.&lt;ME_NAME&gt;</span></code> folder which will be created if it doesn’t already exists.</p>
</section>
<section id="final-deployment">
<h4><span class="section-number">8.4.2.3. </span>Final Deployment<a class="headerlink" href="#final-deployment" title="Link to this heading">¶</a></h4>
<p>To deploy the newly built ME in the third partition of (virtual) SD-card use the deploy.sh script found in the``agency/`` folder.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>agency
./deploy.sh<span class="w"> </span>-m<span class="w"> </span>SOO.&lt;ME_NAME&gt;
</pre></div>
</div>
</section>
<section id="me-injection-from-the-agency">
<h4><span class="section-number">8.4.2.4. </span>ME Injection from the Agency<a class="headerlink" href="#me-injection-from-the-agency" title="Link to this heading">¶</a></h4>
<p>It’s time to test the new ME in the running environment. To do that,
simply start the framework. The agency process which is started
automatically will inspect the contents of <code class="docutils literal notranslate"><span class="pre">/mnt/ME</span></code> directory and
load all available <code class="docutils literal notranslate"><span class="pre">itb</span></code> files.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="emiso_engine/emiso_engine.html" class="btn btn-neutral float-left" title="7. EMISO Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="logging.html" class="btn btn-neutral float-right" title="9. Logging facility" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, HEIG-VD - REDS Institute.
      <span class="lastupdated">Last updated on 31 Oct 2023, 12:53.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>